{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.reducer = exports.combineReducers = void 0;\n\nconst logger_1 = __importDefault(require(\"../logger\"));\n\nconst types_1 = require(\"../types\");\n\nconst utils_1 = require(\"./utils\");\n\nconst combineReducers = function () {\n  for (var _len = arguments.length, reducers = new Array(_len), _key = 0; _key < _len; _key++) {\n    reducers[_key] = arguments[_key];\n  }\n\n  return (state, action) => reducers.reduce((newState, reducer) => reducer(newState, action), state);\n};\n\nexports.combineReducers = combineReducers;\n\nconst reducer = (state, action) => {\n  var _a;\n\n  const gatewayStatus = (0, utils_1.statusFromToken)(state, state.gatewayToken) || types_1.GatewayStatus.UNKNOWN;\n  const updatedState = Object.assign(Object.assign({}, state), {\n    gatewayStatus\n  }); // eslint-disable-next-line no-prototype-builtins\n\n  const tokenCreationInProgress = !!((_a = updatedState.civicPass.responsePayload) === null || _a === void 0 ? void 0 : _a.hasOwnProperty(types_1.CivicPassMessageAction.ISSUANCE));\n  logger_1.default.debug(`reducer.action: ${action.type}`, types_1.GatewayStatus[updatedState.gatewayStatus]);\n\n  switch (action.type) {\n    case 'startWalletPowo':\n      {\n        return Object.assign(Object.assign({}, updatedState), {\n          walletPowoInProgress: true\n        });\n      }\n\n    case 'walletPowoComplete':\n      {\n        logger_1.default.debug('tokenCreationInProgress', {\n          tokenCreationInProgress\n        });\n        return Object.assign(Object.assign({}, updatedState), {\n          // only move to IN_REVIEW if it's during the initial token creation flow\n          gatewayStatus: tokenCreationInProgress ? types_1.GatewayStatus.IN_REVIEW : updatedState.gatewayStatus,\n          walletPowoInProgress: false,\n          firstTokenCheck: false\n        });\n      }\n\n    case 'walletPowoIncomplete':\n      {\n        logger_1.default.debug('tokenCreationInProgress', {\n          tokenCreationInProgress\n        });\n        return Object.assign(Object.assign({}, state), {\n          renderIframe: false,\n          iframeMinimized: true,\n          powoFinished: false,\n          refreshTokenState: types_1.RefreshTokenState.IN_PROGRESS\n        });\n      }\n\n    case 'tokenChange':\n      return Object.assign(Object.assign({}, state), {\n        gatewayStatus: (0, utils_1.statusFromToken)(state, action.token),\n        powoFinished: false,\n        gatewayToken: action.token,\n        tokenIssuanceState: types_1.TokenIssuanceState.COMPLETED\n      });\n\n    case 'powoComplete':\n      return Object.assign(Object.assign({}, updatedState), {\n        gatewayStatus: types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP,\n        powoFinished: true,\n        powoRequested: undefined,\n        refreshIntervalId: undefined,\n        refreshTokenState: state.refreshTokenState === types_1.RefreshTokenState.IN_PROGRESS ? types_1.RefreshTokenState.REQUIRES_POWO : state.refreshTokenState\n      });\n\n    case 'walletDisconnected':\n      return (0, utils_1.resetState)(state);\n\n    case 'requestGatekeeperIssuance':\n      return Object.assign(Object.assign({}, updatedState), {\n        powoFinished: false,\n        walletPowoInProgress: false,\n        tokenIssuanceState: types_1.TokenIssuanceState.IN_PROGRESS\n      });\n\n    case 'requestGatekeeperIssuanceComplete':\n      return Object.assign(Object.assign({}, updatedState), {\n        tokenIssuanceState: types_1.TokenIssuanceState.COMPLETED\n      });\n\n    case 'requestGatekeeperIssuanceFailed':\n      return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), {\n        gatewayStatus: types_1.GatewayStatus.ERROR,\n        tokenIssuanceState: types_1.TokenIssuanceState.FAILED\n      });\n\n    case 'refreshAttemptDone':\n      return Object.assign(Object.assign({}, updatedState), {\n        refreshInProgress: false\n      });\n\n    case 'updateStateWithProps':\n      return Object.assign(Object.assign({}, state), {\n        stage: action.stage,\n        walletAddress: action.walletAddress,\n        redirectUrl: action.redirectUrl,\n        gatekeeperNetworkAddress: action.gatekeeperNetworkAddress\n      });\n\n    case 'tokenNotFoundError':\n      return Object.assign(Object.assign({}, state), {\n        gatewayStatus: types_1.GatewayStatus.ERROR\n      });\n\n    case 'gatekeeperNetworkChanged':\n      return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), {\n        gatekeeperNetworkAddress: action.gatekeeperNetworkAddress,\n        walletAddress: state.walletAddress\n      });\n\n    default:\n      return state;\n  }\n};\n\nexports.reducer = reducer;","map":{"version":3,"sources":["/Users/shawn/metaplex/js/packages/candy-machine-ui/node_modules/@civic/solana-gateway-react/dist/esm/useReducer/reducer.js"],"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","reducer","combineReducers","logger_1","require","types_1","utils_1","reducers","state","action","reduce","newState","_a","gatewayStatus","statusFromToken","gatewayToken","GatewayStatus","UNKNOWN","updatedState","assign","tokenCreationInProgress","civicPass","responsePayload","hasOwnProperty","CivicPassMessageAction","ISSUANCE","default","debug","type","walletPowoInProgress","IN_REVIEW","firstTokenCheck","renderIframe","iframeMinimized","powoFinished","refreshTokenState","RefreshTokenState","IN_PROGRESS","token","tokenIssuanceState","TokenIssuanceState","COMPLETED","PROOF_OF_WALLET_OWNERSHIP","powoRequested","undefined","refreshIntervalId","REQUIRES_POWO","resetState","ERROR","FAILED","refreshInProgress","stage","walletAddress","redirectUrl","gatekeeperNetworkAddress"],"mappings":"AAAA;;AACA,IAAIA,eAAe,GAAI,QAAQ,KAAKA,eAAd,IAAkC,UAAUC,GAAV,EAAe;AACnE,SAAQA,GAAG,IAAIA,GAAG,CAACC,UAAZ,GAA0BD,GAA1B,GAAgC;AAAE,eAAWA;AAAb,GAAvC;AACH,CAFD;;AAGAE,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;AACAD,OAAO,CAACE,OAAR,GAAkBF,OAAO,CAACG,eAAR,GAA0B,KAAK,CAAjD;;AACA,MAAMC,QAAQ,GAAGT,eAAe,CAACU,OAAO,CAAC,WAAD,CAAR,CAAhC;;AACA,MAAMC,OAAO,GAAGD,OAAO,CAAC,UAAD,CAAvB;;AACA,MAAME,OAAO,GAAGF,OAAO,CAAC,SAAD,CAAvB;;AACA,MAAMF,eAAe,GAAG;AAAA,oCAAIK,QAAJ;AAAIA,IAAAA,QAAJ;AAAA;;AAAA,SAAiB,CAACC,KAAD,EAAQC,MAAR,KAAmBF,QAAQ,CAACG,MAAT,CAAgB,CAACC,QAAD,EAAWV,OAAX,KAAuBA,OAAO,CAACU,QAAD,EAAWF,MAAX,CAA9C,EAAkED,KAAlE,CAApC;AAAA,CAAxB;;AACAT,OAAO,CAACG,eAAR,GAA0BA,eAA1B;;AACA,MAAMD,OAAO,GAAG,CAACO,KAAD,EAAQC,MAAR,KAAmB;AAC/B,MAAIG,EAAJ;;AACA,QAAMC,aAAa,GAAG,CAAC,GAAGP,OAAO,CAACQ,eAAZ,EAA6BN,KAA7B,EAAoCA,KAAK,CAACO,YAA1C,KAA2DV,OAAO,CAACW,aAAR,CAAsBC,OAAvG;AACA,QAAMC,YAAY,GAAGrB,MAAM,CAACsB,MAAP,CAActB,MAAM,CAACsB,MAAP,CAAc,EAAd,EAAkBX,KAAlB,CAAd,EAAwC;AAAEK,IAAAA;AAAF,GAAxC,CAArB,CAH+B,CAI/B;;AACA,QAAMO,uBAAuB,GAAG,CAAC,EAAE,CAACR,EAAE,GAAGM,YAAY,CAACG,SAAb,CAAuBC,eAA7B,MAAkD,IAAlD,IAA0DV,EAAE,KAAK,KAAK,CAAtE,GAA0E,KAAK,CAA/E,GAAmFA,EAAE,CAACW,cAAH,CAAkBlB,OAAO,CAACmB,sBAAR,CAA+BC,QAAjD,CAArF,CAAjC;AACAtB,EAAAA,QAAQ,CAACuB,OAAT,CAAiBC,KAAjB,CAAwB,mBAAkBlB,MAAM,CAACmB,IAAK,EAAtD,EAAyDvB,OAAO,CAACW,aAAR,CAAsBE,YAAY,CAACL,aAAnC,CAAzD;;AACA,UAAQJ,MAAM,CAACmB,IAAf;AACI,SAAK,iBAAL;AAAwB;AACpB,eAAO/B,MAAM,CAACsB,MAAP,CAActB,MAAM,CAACsB,MAAP,CAAc,EAAd,EAAkBD,YAAlB,CAAd,EAA+C;AAAEW,UAAAA,oBAAoB,EAAE;AAAxB,SAA/C,CAAP;AACH;;AACD,SAAK,oBAAL;AAA2B;AACvB1B,QAAAA,QAAQ,CAACuB,OAAT,CAAiBC,KAAjB,CAAuB,yBAAvB,EAAkD;AAAEP,UAAAA;AAAF,SAAlD;AACA,eAAOvB,MAAM,CAACsB,MAAP,CAActB,MAAM,CAACsB,MAAP,CAAc,EAAd,EAAkBD,YAAlB,CAAd,EAA+C;AAClD;AACAL,UAAAA,aAAa,EAAEO,uBAAuB,GAAGf,OAAO,CAACW,aAAR,CAAsBc,SAAzB,GAAqCZ,YAAY,CAACL,aAFtC;AAEqDgB,UAAAA,oBAAoB,EAAE,KAF3E;AAEkFE,UAAAA,eAAe,EAAE;AAFnG,SAA/C,CAAP;AAGH;;AACD,SAAK,sBAAL;AAA6B;AACzB5B,QAAAA,QAAQ,CAACuB,OAAT,CAAiBC,KAAjB,CAAuB,yBAAvB,EAAkD;AAAEP,UAAAA;AAAF,SAAlD;AACA,eAAOvB,MAAM,CAACsB,MAAP,CAActB,MAAM,CAACsB,MAAP,CAAc,EAAd,EAAkBX,KAAlB,CAAd,EAAwC;AAAEwB,UAAAA,YAAY,EAAE,KAAhB;AAAuBC,UAAAA,eAAe,EAAE,IAAxC;AAA8CC,UAAAA,YAAY,EAAE,KAA5D;AAAmEC,UAAAA,iBAAiB,EAAE9B,OAAO,CAAC+B,iBAAR,CAA0BC;AAAhH,SAAxC,CAAP;AACH;;AACD,SAAK,aAAL;AACI,aAAOxC,MAAM,CAACsB,MAAP,CAActB,MAAM,CAACsB,MAAP,CAAc,EAAd,EAAkBX,KAAlB,CAAd,EAAwC;AAAEK,QAAAA,aAAa,EAAE,CAAC,GAAGP,OAAO,CAACQ,eAAZ,EAA6BN,KAA7B,EAAoCC,MAAM,CAAC6B,KAA3C,CAAjB;AAAoEJ,QAAAA,YAAY,EAAE,KAAlF;AAAyFnB,QAAAA,YAAY,EAAEN,MAAM,CAAC6B,KAA9G;AAAqHC,QAAAA,kBAAkB,EAAElC,OAAO,CAACmC,kBAAR,CAA2BC;AAApK,OAAxC,CAAP;;AACJ,SAAK,cAAL;AACI,aAAO5C,MAAM,CAACsB,MAAP,CAActB,MAAM,CAACsB,MAAP,CAAc,EAAd,EAAkBD,YAAlB,CAAd,EAA+C;AAAEL,QAAAA,aAAa,EAAER,OAAO,CAACW,aAAR,CAAsB0B,yBAAvC;AAAkER,QAAAA,YAAY,EAAE,IAAhF;AAAsFS,QAAAA,aAAa,EAAEC,SAArG;AAAgHC,QAAAA,iBAAiB,EAAED,SAAnI;AAA8IT,QAAAA,iBAAiB,EAAE3B,KAAK,CAAC2B,iBAAN,KAA4B9B,OAAO,CAAC+B,iBAAR,CAA0BC,WAAtD,GAC7MhC,OAAO,CAAC+B,iBAAR,CAA0BU,aADmL,GAE7MtC,KAAK,CAAC2B;AAFsC,OAA/C,CAAP;;AAGJ,SAAK,oBAAL;AACI,aAAO,CAAC,GAAG7B,OAAO,CAACyC,UAAZ,EAAwBvC,KAAxB,CAAP;;AACJ,SAAK,2BAAL;AACI,aAAOX,MAAM,CAACsB,MAAP,CAActB,MAAM,CAACsB,MAAP,CAAc,EAAd,EAAkBD,YAAlB,CAAd,EAA+C;AAAEgB,QAAAA,YAAY,EAAE,KAAhB;AAAuBL,QAAAA,oBAAoB,EAAE,KAA7C;AAAoDU,QAAAA,kBAAkB,EAAElC,OAAO,CAACmC,kBAAR,CAA2BH;AAAnG,OAA/C,CAAP;;AACJ,SAAK,mCAAL;AACI,aAAOxC,MAAM,CAACsB,MAAP,CAActB,MAAM,CAACsB,MAAP,CAAc,EAAd,EAAkBD,YAAlB,CAAd,EAA+C;AAAEqB,QAAAA,kBAAkB,EAAElC,OAAO,CAACmC,kBAAR,CAA2BC;AAAjD,OAA/C,CAAP;;AACJ,SAAK,iCAAL;AACI,aAAO5C,MAAM,CAACsB,MAAP,CAActB,MAAM,CAACsB,MAAP,CAAc,EAAd,EAAkB,CAAC,GAAGb,OAAO,CAACyC,UAAZ,EAAwBvC,KAAxB,CAAlB,CAAd,EAAiE;AAAEK,QAAAA,aAAa,EAAER,OAAO,CAACW,aAAR,CAAsBgC,KAAvC;AAA8CT,QAAAA,kBAAkB,EAAElC,OAAO,CAACmC,kBAAR,CAA2BS;AAA7F,OAAjE,CAAP;;AACJ,SAAK,oBAAL;AACI,aAAOpD,MAAM,CAACsB,MAAP,CAActB,MAAM,CAACsB,MAAP,CAAc,EAAd,EAAkBD,YAAlB,CAAd,EAA+C;AAAEgC,QAAAA,iBAAiB,EAAE;AAArB,OAA/C,CAAP;;AACJ,SAAK,sBAAL;AACI,aAAOrD,MAAM,CAACsB,MAAP,CAActB,MAAM,CAACsB,MAAP,CAAc,EAAd,EAAkBX,KAAlB,CAAd,EAAwC;AAAE2C,QAAAA,KAAK,EAAE1C,MAAM,CAAC0C,KAAhB;AAAuBC,QAAAA,aAAa,EAAE3C,MAAM,CAAC2C,aAA7C;AAA4DC,QAAAA,WAAW,EAAE5C,MAAM,CAAC4C,WAAhF;AAA6FC,QAAAA,wBAAwB,EAAE7C,MAAM,CAAC6C;AAA9H,OAAxC,CAAP;;AACJ,SAAK,oBAAL;AACI,aAAOzD,MAAM,CAACsB,MAAP,CAActB,MAAM,CAACsB,MAAP,CAAc,EAAd,EAAkBX,KAAlB,CAAd,EAAwC;AAAEK,QAAAA,aAAa,EAAER,OAAO,CAACW,aAAR,CAAsBgC;AAAvC,OAAxC,CAAP;;AACJ,SAAK,0BAAL;AACI,aAAOnD,MAAM,CAACsB,MAAP,CAActB,MAAM,CAACsB,MAAP,CAAc,EAAd,EAAkB,CAAC,GAAGb,OAAO,CAACyC,UAAZ,EAAwBvC,KAAxB,CAAlB,CAAd,EAAiE;AAAE8C,QAAAA,wBAAwB,EAAE7C,MAAM,CAAC6C,wBAAnC;AAA6DF,QAAAA,aAAa,EAAE5C,KAAK,CAAC4C;AAAlF,OAAjE,CAAP;;AACJ;AACI,aAAO5C,KAAP;AArCR;AAuCH,CA9CD;;AA+CAT,OAAO,CAACE,OAAR,GAAkBA,OAAlB","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.reducer = exports.combineReducers = void 0;\nconst logger_1 = __importDefault(require(\"../logger\"));\nconst types_1 = require(\"../types\");\nconst utils_1 = require(\"./utils\");\nconst combineReducers = (...reducers) => (state, action) => reducers.reduce((newState, reducer) => reducer(newState, action), state);\nexports.combineReducers = combineReducers;\nconst reducer = (state, action) => {\n    var _a;\n    const gatewayStatus = (0, utils_1.statusFromToken)(state, state.gatewayToken) || types_1.GatewayStatus.UNKNOWN;\n    const updatedState = Object.assign(Object.assign({}, state), { gatewayStatus });\n    // eslint-disable-next-line no-prototype-builtins\n    const tokenCreationInProgress = !!((_a = updatedState.civicPass.responsePayload) === null || _a === void 0 ? void 0 : _a.hasOwnProperty(types_1.CivicPassMessageAction.ISSUANCE));\n    logger_1.default.debug(`reducer.action: ${action.type}`, types_1.GatewayStatus[updatedState.gatewayStatus]);\n    switch (action.type) {\n        case 'startWalletPowo': {\n            return Object.assign(Object.assign({}, updatedState), { walletPowoInProgress: true });\n        }\n        case 'walletPowoComplete': {\n            logger_1.default.debug('tokenCreationInProgress', { tokenCreationInProgress });\n            return Object.assign(Object.assign({}, updatedState), { \n                // only move to IN_REVIEW if it's during the initial token creation flow\n                gatewayStatus: tokenCreationInProgress ? types_1.GatewayStatus.IN_REVIEW : updatedState.gatewayStatus, walletPowoInProgress: false, firstTokenCheck: false });\n        }\n        case 'walletPowoIncomplete': {\n            logger_1.default.debug('tokenCreationInProgress', { tokenCreationInProgress });\n            return Object.assign(Object.assign({}, state), { renderIframe: false, iframeMinimized: true, powoFinished: false, refreshTokenState: types_1.RefreshTokenState.IN_PROGRESS });\n        }\n        case 'tokenChange':\n            return Object.assign(Object.assign({}, state), { gatewayStatus: (0, utils_1.statusFromToken)(state, action.token), powoFinished: false, gatewayToken: action.token, tokenIssuanceState: types_1.TokenIssuanceState.COMPLETED });\n        case 'powoComplete':\n            return Object.assign(Object.assign({}, updatedState), { gatewayStatus: types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP, powoFinished: true, powoRequested: undefined, refreshIntervalId: undefined, refreshTokenState: state.refreshTokenState === types_1.RefreshTokenState.IN_PROGRESS\n                    ? types_1.RefreshTokenState.REQUIRES_POWO\n                    : state.refreshTokenState });\n        case 'walletDisconnected':\n            return (0, utils_1.resetState)(state);\n        case 'requestGatekeeperIssuance':\n            return Object.assign(Object.assign({}, updatedState), { powoFinished: false, walletPowoInProgress: false, tokenIssuanceState: types_1.TokenIssuanceState.IN_PROGRESS });\n        case 'requestGatekeeperIssuanceComplete':\n            return Object.assign(Object.assign({}, updatedState), { tokenIssuanceState: types_1.TokenIssuanceState.COMPLETED });\n        case 'requestGatekeeperIssuanceFailed':\n            return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), { gatewayStatus: types_1.GatewayStatus.ERROR, tokenIssuanceState: types_1.TokenIssuanceState.FAILED });\n        case 'refreshAttemptDone':\n            return Object.assign(Object.assign({}, updatedState), { refreshInProgress: false });\n        case 'updateStateWithProps':\n            return Object.assign(Object.assign({}, state), { stage: action.stage, walletAddress: action.walletAddress, redirectUrl: action.redirectUrl, gatekeeperNetworkAddress: action.gatekeeperNetworkAddress });\n        case 'tokenNotFoundError':\n            return Object.assign(Object.assign({}, state), { gatewayStatus: types_1.GatewayStatus.ERROR });\n        case 'gatekeeperNetworkChanged':\n            return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), { gatekeeperNetworkAddress: action.gatekeeperNetworkAddress, walletAddress: state.walletAddress });\n        default:\n            return state;\n    }\n};\nexports.reducer = reducer;\n"]},"metadata":{},"sourceType":"script"}